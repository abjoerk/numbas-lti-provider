{% extends "numbas_lti/management/base.html" %}
{% load bootstrap %}
{% load i18n %}
{% load staticfiles %}

{% block management_content %}
<h2>{% trans "Statistics" %}</h2>

<h3>{% trans "Attempt completion" %}</h3>
<table class="table" id="completion-table">
    <tbody>
        {% for label,value,n in completion_counts %}
        <tr>
            <td>{{label}}</td>
            <td class="value" data-value="{{value}}">{{n}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>{% trans "Summary statistics" %}</h3>
<p>{% trans "Total exam score" %}</p>
<table class="table" id="summary-stats-table">
    <thead>
        <tr>
            <th>{% trans "Mean" %}</th>
            <th>{% trans "Lower quartile" %}</th>
            <th>{% trans "Median" %}</th>
            <th>{% trans "Upper quartile" %}</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="value" data-value="mean"></td>
            <td class="value" data-value="q1"></td>
            <td class="value" data-value="median"></td>
            <td class="value" data-value="q3"></td>
        </tr>
    </tbody>
</table>

<section id="stacked_status_chart">
    <div class="legend">
        <span class="num_not_attempted">
            <svg class="box" width="20" height="20"><rect width="20" height="20"></rect></svg>
            Not attempted
        </span>
        <span class="num_incorrect">
            <svg class="box" width="20" height="20"><rect width="20" height="20"></rect></svg>
            Incorrect
        </span>
        <span class="num_partial">
            <svg class="box" width="20" height="20"><rect width="20" height="20"></rect></svg>
            Partially correct
        </span>
        <span class="num_correct">
            <svg class="box" width="20" height="20"><rect width="20" height="20"></rect></svg>
            Correct
        </span>
    </div>
    <div class="chart">
        <svg class="diagram"></svg>
    </div>
</section>


<h3>{% trans "Score distribution" %}</h3>
<p>{% blocktrans %}In the following charts, the <i>x</i>-axis represents scaled score, and the <i>y</i>-axis represents the number of attempts achieving that score.{% endblocktrans %}</p>

<section id="question_scores_chart" class="chart"></section>

{% endblock %}

{% block stylesheets %}
    {{block.super}}

    <style>
        .chart svg {
            display: block;
            margin: 2rem auto;
            width: 100%;
        }
        .ct-label {
            font-size: 1em;
        }
        .x-axis .tick line {
            stroke: #ccc;
            stroke-dasharray: 2 2;
        }
        .question-dot {
            opacity: 0.5;
        }

        section {
            margin: 3rem auto;
        }

        .num_not_attempted rect {
            fill: #eee;
            stroke: #888;
        }
        .num_incorrect rect {
            fill: red;
        }
        .num_partial rect {
            fill: lightslategrey;
        }
        .num_correct rect {
            fill: lime;
        }

        .legend {
            display: flex;
            justify-content: space-evenly;
        }
        .legend > span {
            margin: 1em;
        }

        #stacked_status_chart .percentage {
            text-anchor: middle;
        }
    </style>
{% endblock %}

{% block javascripts %}
{{block.super}}

    <script src="{% static 'robust-websocket.js' %}"></script>

    <script src="{% static 'd3/d3.min.js' %}"></script>

    <script>
        var data = {{data|safe}};
    </script>

    <script src="{% static 'resource-stats.js' %}" defer></script>
{% endblock %}
